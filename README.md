# z_scheduler
#调度平台
##调度与监控介绍和使用说明 文档V1.0
    			2016-10-10 09:28:33

#1.功能划分
#2.运维要点

##1.1调度
###1.1.0调度的几个逻辑概念

![scheduler concept ](/tree/master/src/main/resources/img/1.png)


Job > batch> seq>task

 概念 | 解释
---|---
JOB作业 | 每个job有多个批次,批次是一个逻辑概念,创建task的时候指定,有固定的调度频率,设置分钟数,月调度,目前处理季度任务的时候是指定按照月来调度,但是如果不是第二个季度头一天,那么shell脚本中做跳过处理
Batch批次 | 每个job有多个批次,批次是一个逻辑概念,创建task的时候指定,有固定的调度频率,设置分钟数,月调度,目前处理季度任务的时候是指定按照月来调度,但是如果不是第二个季度头一天,那么shell脚本中做跳过处理,批次中有最大并行线程的限制
Seq 序列 | 由于同一个批次中的任务会有依赖关系,所以建立task的时候指定在batch中的序列,执行任务的时候,按照字典顺序执行
Task 作业 | shell任务,包含多个类型shell任务,目前主要包括(数据从oracle导入,执行hivesql脚本以及sqoop导入到oracle中)

###1.1.1界面调度
####1.1.1.1 功能介绍
界面地址: http://10.201.48.101:8080/z_bigdata/index
 
![project screeshot ](/tree/master/src/main/resources/img/2.png)

链接|说明
------|------
Batch的配置信息	|列出整个调度平台所有的批次
Task 的配置信息	|列出整个调度平台所有的作业
历史信息	|根据筛选条件,查出每个task运行的状况
ETL脚本上传及重跑页面	|提供sql上传, shell脚本生成, 手动重跑
ETL	|目前所有ETL的依赖管理,调度管理 功能,除特殊任务外,需要手动改写shell脚本
刷新内存map	|修改batch信息后,界面查看批次状态
监控	|根据定时任务更新得到oracle中表的数据量(功能待完善),可查询
前端对应后台	|由于oracle中dim_sys_url 更新导致功能不可用
添加的源表	|数据源接入,供给etl配置依赖(康凯负责添加新表接入)
Etl_error_Log	|每日导入的失败任务
Pdata_error_log	|数据仓库的失败任务统计
修改前端页面后点我	|更新front表(以供找到ETL)
获取oracle中的数据量	|获取oracle中最新的各个表中的数据量,可以通过监控查看结果
发送批次运行状态	|邮件发送批次的运行状态


###1.1.2 后台脚本调度(之前交接过很多次,主要说一些特殊情况)
* 	脚本路径 10.201.48.26  /home/bl/ETL  /home/bl/IMPORT/
* 	脚本的日志 可以通过 http://10.201.48.26/ 访问
* 	Oracle 清空数据的脚本,目前存放在 oracle@10.201.48.18  /home/oracle 目录下
* 	目前所有的新接入的表和已经接入过的表,新建立的结果表,全部以 \001 作为分隔符
* 	脚本生成通过前段的ETL界面生成,修改基于前台生成的shell脚本
* 	按照之前的规范,全量的表为非分区表,增量的表以日期作为分区,按天分区的格式为yyyyMMdd 按月分区的为 yyyyMM
* 	如果oracle中存在blob,clob字段,sqoop的导入语句需要另行处理(可以问康凯)
* 	后台的job全部由hive角色执行,具体可以看源码
###1.1.3 错误处理
* 	JOB中由于新上task的问题导致,所有的新上的job都必须先由前端界面跑一次,才能设置为可运行状态
* 	由于表占用导致的task失败,之前发现过由于推荐的任务运行,导致task的前置资源一直被占用,task没有返回状态,处理办法,只能是按照优先级,如果前台要求比较迫切,后台通过yarn结束掉占用的applicationID
* 	导入导出失败,这种比较常见,具体问题具体分析
* 	之前由于mysql连接丢失,导致数据出来的太慢,目前已经配置了邮件通知

###1.1.4 ETL,前台,调度配置和依赖管理
分别和test和ETL 单独讲过,可以简单操作
##1.2监控
###1.2.1 邮件通知
	发到公司和外网的邮箱,通过项目的mail.properties文件配置
###1.2.1 
##2.1日常运维
目前已经比较稳定,上一上task,特殊需求写一写脚本,跑一跑task 


附:
调度和监控的项目我问一下然后放到公司的git上

